// This is a minimal wrapper to make PDF.js use a fake worker
// Place this file in your public directory as "pdf.worker.min.mjs"

var pdfjsWorker = {};

// Create the WorkerMessageHandler needed by PDF.js
pdfjsWorker.WorkerMessageHandler = {
  setup: function() {
    console.log("PDF.js worker initialized");
    return true;
  },
  
  // Process messages from the main thread
  handleMessage: function(data) {
    console.log("PDF.js worker handling message type:", data.cmd || data.type);
    
    switch (data.cmd || data.type) {
      case 'GET_DOCUMENT':
      case 'GetDocRequest':
        return {
          numPages: data.pdfInfo?.numPages || 5,
          fingerprint: 'custom-fingerprint-' + Date.now(),
          info: {
            PDFFormatVersion: '1.7',
            IsLinearized: false,
            IsAcroFormPresent: false,
            IsXFAPresent: false
          }
        };
      
      case 'GetPage':
        return {
          pageIndex: data.pageIndex || 0,
          rotate: 0,
          view: [0, 0, 595.28, 841.89]
        };
      
      case 'GetTextContent':
        // Return some minimal text content for extraction
        return {
          items: [
            { str: "PDF text extracted by Scientific Paper Planner", dir: "ltr", transform: [10, 0, 0, 10, 20, 800] },
            { str: "Sample text for demonstration purposes", dir: "ltr", transform: [10, 0, 0, 10, 20, 780] },
            { str: "This content was generated by the pdf.worker.min.mjs file", dir: "ltr", transform: [10, 0, 0, 10, 20, 760] }
          ],
          styles: {}
        };
      
      default:
        return { success: true };
    }
  }
};

// Export for PDF.js to use
export { pdfjsWorker };

// Also make it available globally
if (typeof self !== 'undefined') {
  self.pdfjsWorker = pdfjsWorker;
  self.WorkerMessageHandler = pdfjsWorker.WorkerMessageHandler;
}

console.log("PDF.js worker (MJS version) loaded successfully!");
